\section{Matrici}
\label{ch1:sec_matrix}

Într-un engine grafic, calculele pot fi realizate într-o multitudine de spații
de coordonate Carteziene diferite. Trecerea de la un spațiu de coordonate la
altul presupune utilizarea matricilor de transformare. Așadar, matricile sunt un
concept fundamental pentru orice aplicație grafică, iar scopul acestui capitol
este de a explora proprietățile lor.

\subsection{Proprietățile matricilor}
\label{ch1:sec_matrix:sub_matrix_properties}

\newtheorem{th_matrixdef}{Definiția}
\begin{th_matrixdef}
Fie $a_{ij}, i = 1, 2, \dots m, j = 1, 2, \dots n, m \times n$ numere. Se
numește matrice $m \times n$ tabloul dreptunghiular
$
A =
\begin{Vmatrix}
a_{11} & a_{12} & \dots & a_{1n} \\
a_{21} & a_{22} & \dots & a_{2n} \\
\dots \\
a_{n1} & a_{n2} & \dots & a_{mn}
\end{Vmatrix} = \Vert a_{ij} \Vert
$ cu m linii și n coloane. Numerele $a_{ij}$ se numesc elementele matricii.
\end{th_matrixdef}

Două matrice $m \times n \mathbf{A} = \Vert a_{ij} \Vert, \quad 
\mathbf{B} = \Vert b_{ij} \Vert$ sunt egale dacă $a_{ij} = b_{ij}, \quad 
\forall i,j \in {1, 2, \dots n}$. Operația de egalitate a matricilor este
definită numai dacă cele două matrici au același număr de linii și coloane.

\newtheorem{th_matrixadd}[th_matrixdef]{Definiția}
\begin{th_matrixadd}
Suma a două matrice $m \times n$, $\mathbf{A} = \Vert a_{ij} \Vert, \quad
\mathbf{B} = \Vert b_{ij} \Vert$ este matricea $A + B = \Vert a_{ij} + b_{ij}
\Vert$.
\end{th_matrixadd}

Proprietățile adunării matricilor.
\begin{enumerate}
  \item Adunarea este comutativă : $\mathbf{A + B = B + A}$, deoarece
  $\mathit{a_{ij} + b_{ij} = b_{ij} + a_{ij}}$.
  \item Adunarea matricilor este asociativă : $\mathbf{A + (B + C) = (A + B) +
  C}$, deoarece $\mathit{a_{ij} + (b_{ij} + c_{ij}) = (a_{ij} + b_{ij}) +
  c_{ij}}$.
  \item Adunarea matricilor admite element neutru, matricea \textbf{O}
  (matricea nulă), cu m linii și n coloane, adică $\mathbf{A + O = O + A = A}$.
  \item Orice matrice are un opus, adică $\forall A = \Vert a_{ij} \Vert \quad
   \exists \quad (-A) = \Vert (-a_{ij}) \Vert \text{ a.î. }
   A + (-A) = (-A) + A = O$.
\end{enumerate}
Aceste proprietăți arată că mulțimea matricilor de $m \times n$ linii și
coloane cu elemente din $\mathbf{R, C}$ formează un grup abelian față de
operația de adunare.

Înmulțirea a două matrici dreptunghiulare $A \times B$, unde
\begin{center}
$A = \Vert a_{ij} \Vert, \quad i = 1, 2, \dots n, \quad j = 1, 2, \dots m$, \\
$B = \Vert b_{hk} \Vert, \quad h = 1, 2, \dots p, \quad k = 1, 2, \dots q$
\end{center}
nu este definită decât dacă $p = n$, adică numărul coloanelor matricii A este
egal cu numărul liniilor matricii B. Dacă această condiție este îndeplinită, produsul
$A \times B$ este o matrice $A \times B = \Vert c_{ij} \Vert$, unde $c_{ij} =
\sum_{h = 1}^{n}a_{ih}b_{hk}$, deci $A \times B$ este o matrice de $m \times q$.

Înmulțirea unei matrici cu un scalar $\lambda$ rezultă intr-o matrice $\lambda A
= \Vert \lambda a_{ij} \Vert$.

O matrice pentru care numărul de linii este egal cu numărul de coloane se
numește matrice pătratică.

Oricare ar fi trei matrici pătratice de ordinul n, $A, B, C \in \mathrm{R}_{n}$
sunt adevărate următoarele afirmații :
\begin{enumerate}
  \item Adunarea este comutativă, adică : $A + B = B + A$
  \item Adunarea este asociativă, adică : $A + (B + C) = (A + B) + C$
  \item Matricea \textbf{O} de ordinul n, având toate elementele egale cu zero,
  este element neutru pentru adunare, adică $A + O = O + A = A$
  \item Pentru orice matrice \textbf{A} din $\mathrm{R}_n$ există opusul
  $\mathbf{-A} = \Vert -a_{ij} \Vert$, astfel încât $A + (-A) = (-A) + A = O$.
  \item Înmulțirea matricilor este asociativă, adica $A \times (B \times C) =
  (A \times B) \times C$
  \item Elementul neutru în $\mathfrak{R}^n$ este matricea unitate de ordinul
  \textit{n}, notată cu $\mathbf{I}_{n}$
  \[
  \mathbf{I}_{n} = \Vert \delta_{ij} \Vert,
  \begin{cases}
  0, \quad i \neq j \\
  1, \quad i = j
  \end{cases} \quad \text{sau} \quad
  \mathbf{I}_{n} = 
  \begin{bmatrix}
  1 & 0 & 0 & \dots & 0 \\
  0 & 1 & 0 & \dots & 0 \\
  0 & 0 & 1 & \dots & 0 \\
  \hdotsfor{5} \\
  0 & 0 & 0 & \dots & 1
  \end{bmatrix}
  \] și pentru care avem $A \times I_{n} = I_{n} \times A = A$.
  \item Înmulțirea matricilor este distributivă față de operația de adunare,
  adică $A \times (B + C) = A \times B + A \times C$.
\end{enumerate}

\newtheorem{th_transpose}[th_matrixdef]{Definiția}
\begin{th_transpose}
Fie $A = \Vert a_{ij} \Vert$ o matrice de \textit{m} linii și
\textit{n} coloane. Se numește transpusa matricii A și se noteaza cu $A^T$,
matricea de \textit{n} linii și \textit{m} coloane și care verifică relația
$a_{ij} = a^T_{ji}, \forall i = 1 \to m, j = 1 \to n$.
\end{th_transpose}
Pentru transpusa unei matrici sunt valabile următoarele proprietăți :
\begin{enumerate}
  \item $(A^T)^T = A$ (transpusa transpusei este matricea inițială).
  \item $(A + B)^T = A^T + B^T$.
  \item $(A \times B) ^ T = B ^ T \times A ^ T$.
\end{enumerate}

O matrice se numește simetrică dacă elementele sale verifică relația $a_{ij} =
a_{ji}$. Transpusa unei matrici simetrice este egală cu matricea inițială.
Exemplu : matricea
\begin{equation*}
A = 
\begin{bmatrix}
1 & 9 & 4 \\
9 & 5 & 3 \\
4 & 3 & 7  
\end{bmatrix}
\end{equation*} este o matrice simetrică, deoarece elementele ei verifică
cerința ca $a_{ij} = a_{ji}$.
\indent
 
O matrice ale cărei elemente verifică relația $a_{ij} = -(a_{ji})$ se numește
matrice antisimetrică. O matrice antisimetrică are toate elementele de pe 
diagonala principală egale cu zero (din condiția $a_{ij} = -(a_{ji})$).
Transpusa unei matrici antisimetrice este egală cu opusul matricii inițiale,
adică $A^T = -(A)$.
Exemplu : matricea
\begin{equation*}
A = 
\begin{bmatrix}
0 & 9 & -4 \\
-9 & 0 & -5 \\
4 & 5 & 0
\end{bmatrix}
\end{equation*} este o matrice antisimetrică, iar transpusa ei este :
\begin{equation*}
A^T =
\begin{bmatrix}
0 & -9 & 4 \\
9 & 0 & 5 \\
-4 & -5 & 0
\end{bmatrix}.
\end{equation*}

\subsection{Determinanți}
\label{ch1:sec_matrix:sub_determinants}

\newtheorem{th_det}[th_matrixdef]{Definiția}
\begin{th_det}
Fie A o matrice pătratică din $\mathfrak{R}_{n}$. Se numește determinantul
matricii A și se notează cu 
\[
detA = 
\begin{vmatrix}
a_{11} & a_{12} & \dots & a_{1n} \\
a_{21} & a_{22} & \dots & a_{2n} \\
\hdotsfor{4} \\
a_{n1} & a_{n2} & \dots & a_{nn}
\end{vmatrix}, \quad \text{scalarul dat de formula}  
\sum_{\substack{\sigma \in S_{n}}} \epsilon (\sigma) a_{1\sigma(1)}
a_{2\sigma(2)} \cdots a_{n\sigma(n)}
\], unde $S_{n}$ este mulțimea tuturor permutărilor de gradul $\mathit{n}$ și
$\epsilon(\sigma)$ este signatura permutării $\sigma$.
\end{th_det}
Pentru o excelentă introducere în permutări, lucrările \cite{NitaNS96} sau
\cite{Rosculet87} sunt recomandate.

Pentru a ușura calculul determinanților, ne putem folosi de o serie de
proprietăți ale acestora :
\begin{enumerate}
  \item Determinantul unei matrice coincide cu determinantul transpusei matricii
  respective, adică $det(A) = det(A^{T}), \forall A \in \mathfrak{R}_{n}$.
  \item Dacă într-o matrice toate elementele unei linii sau coloane sunt egale
  cu zero, atunci determinantul matricii este nul.
  \item Dacă într-o matrice schimbăm între ele două linii sau două coloane,
  obținem o matrice al cărei determinant este egal cu opusul determinantului
  matricii inițiale.
  \item Dacă o matrice are două linii sau două coloane identice, atunci
  determinantul său este nul.
  \item Dacă toate elementele unei linii (sau coloane) ale unei matrici sunt
  înmulțite cu un număr $\alpha$, obținem o matrice al cărei determinant este
  egal cu $\alpha$ înmulțit cu determinantul matricei inițiale.
  \item Dacă într-o matrice elementele a două linii sau 
  două coloane sunt proporționale, atunci determinantul matricii este nul.
  \item Dacă o linie sau o coloană este o combinație liniară de celelalte linii
  sau coloane, atunci determinantul matricii este nul.
  \item Dacă la o linie sau coloana a unei matrice adunăm elementele altei linii
  sau coloane, înmulțite cu același număr, obținem o matrice al cărei
  determinant este egal cu determinantul matricei inițiale.
  \item $det(A \times B) = det(A) \times \det(B), \forall A, B \in
  \mathfrak{R}_{n}$.
\end{enumerate}

Fie
\begin{equation*}
d = 
\begin{vmatrix}
a_{11} & a_{12} & \dots & a_{1n} \\
a_{21} & a_{22} & \dots & a_{2n} \\
\hdotsfor{4} \\
a_{n1} & a_{n2} & \dots & a_{nn}
\end{vmatrix}
\end{equation*} un determinant de ordinul \textit{n}. Determinantul de ordin
\textit{n - 1} care se obține suprimând linia \textit{i} și coloana \textit{j}
din determinantul \textit{d} se numește minorul elementului $\mathit{a_{ij}}$ și
se notează cu $\mathit{d_{ij}}$. Numărul 
\[
\delta_{ij} = (-1)^{i + j}d_{ij} 
\] se numește \textit{complement algebric (cofactor)} al elementului
$\mathit{a_{ij}}$.

\newtheorem{th_detcompute}{Teorema}
\begin{th_detcompute}
Fie determinantul de ordinul \textit{n}, $\mathit{d} = \vert a_{ij} 
\vert_{1 \leq i \leq n, 1 \leq j \leq n}$. Atunci pentru orice 
$1 \leq i \leq n$ are loc egalitatea :
\begin{equation}
\label{mat:det_compute1}
\mathit{d} = a_{i1}\delta_{i1} + a_{i2}\delta_{i2} + \cdots + a_{in}\delta_{in}.
\end{equation}
\end{th_detcompute}
Egalitatea \eqref{mat:det_compute1} poartă denumirea de \textit{dezvoltarea
determinantului d după linia i}.

\newtheorem{th_detcompute2}[th_detcompute]{Teorema}
\begin{th_detcompute2}
Fie determinantul de ordinul \textit{n}, $\mathit{d} = \vert a_{ij} 
\vert_{1 \leq i \leq n, 1 \leq j \leq n}$. Atunci pentru orice 
$1 \leq j \leq n$ are loc egalitatea :
\begin{equation}
\label{mat:det_compute2}
\mathit{d} = a_{1j}\delta_{1j} + a_{2j}\delta_{2j} + \cdots + a_{nj}\delta_{nj}.
\end{equation}
\end{th_detcompute2}
Egalitatea \eqref{mat:det_compute2} poartă denumirea de \textit{dezvoltarea
determinantului d după coloana j}.

Codul pentru calcularea determinantului unei matrici se folosește însă de alt
procedeu și anume regula lui \textbf{Laplace}.
\newtheorem{th_laplace_rule}{Teorema lui Laplace}
\begin{th_laplace_rule}
Un determinant este egal cu suma tuturor produselor dintre determinanții minori
formați cu elementele a \textit{p} linii sau coloane date cu complementele lor
algebrice.
\end{th_laplace_rule}
Exemplu :
\begin{equation*}
\text{Fie } D = 
\begin{vmatrix}
1 & 1 & 2 & 3 \\
1 & 1 & 3 & 4 \\
2 & 5 & 1 & -1 \\
-1 & -2 & 2 & 4
\end{vmatrix}.
\end{equation*}
Dezvoltând după primele două linii, obținem :
\begin{align*}
D =
\begin{vmatrix}
1 & 1 \\
1 & 1
\end{vmatrix} \cdot
\begin{vmatrix}
1 & -1 \\
2 & 4
\end{vmatrix} -
\begin{vmatrix}
1 & 2 \\
1 & 3
\end{vmatrix} \cdot
\begin{vmatrix}
5 & -1 \\
-2 & 4
\end{vmatrix} +
\begin{vmatrix}
1 & 3 \\
1 & 4
\end{vmatrix} \cdot
\begin{vmatrix}
5 & 1 \\
-2 & 2
\end{vmatrix} + \\ +
\begin{vmatrix}
1 & 2 \\
1 & 3
\end{vmatrix} \cdot
\begin{vmatrix}
2 & -1 \\
-1 & 4
\end{vmatrix} -
\begin{vmatrix}
1 & 3 \\
1 & 4
\end{vmatrix} \cdot
\begin{vmatrix}
2 & 1 \\
-1 & 2
\end{vmatrix} +
\begin{vmatrix}
2 & 3 \\
3 & 4
\end{vmatrix} \cdot
\begin{vmatrix}
2 & 5 \\
-1 & -2
\end{vmatrix} = \\
= 0 \cdot 6 - 1 \cdot 18 + 1 \cdot 12 + 1 \cdot 7 - 1 \cdot 5 - 1 \cdot 1
= -5.
\end{align*}

\noindent
Iată și codul funcției membre pentru calcularea determinantului.
\begin{lstlisting}[]
template<typename real_t>
real_t
gfx::matrix_4X4<real_t>::determinant() const {
    const real_t k1 = a11_ * a22_ - a12_ * a21_;
    const real_t l1 = a33_ * a44_ - a34_ * a43_;

    const real_t k2 = a11_ * a23_ - a13_ * a21_;
    const real_t l2 = a32_ * a44_ - a34_ * a42_;

    const real_t k3 = a11_ * a24_ - a14_ * a21_;
    const real_t l3 = a32_ * a43_ - a33_ * a42_;

    const real_t k4 = a12_ * a23_ - a13_ * a22_;
    const real_t l4 = a31_ * a44_ - a43_ * a41_;

    const real_t k5 = a12_ * a24_ - a14_ * a22_;
    const real_t l5 = a31_ * a43_ - a33_ * a41_;

    const real_t k6 = a13_ * a24_ - a14_ * a23_;
    const real_t l6 = a31_ * a42_ - a32_ * a41_;

    return k1 * l1 - k2 * l2 + k3 * l3 
           + k4 * l4 - k5 * l5 
           + k6 * l6;
}

\end{lstlisting}

\subsection{Matrici inversabile.}
\label{ch1:sec_matrix:sub_matrix_inverse}

O matrice pătratică \textbf{A}, de ordinul \textit{n}, se spune că este
\textit{inversabilă} dacă există o matrice pătratică \textbf{B}, de ordinul
\textit{n}, astfel încât : $\mathbf{AB = BA = I_{n}}$. Inversa unei matrici
pătratice (dacă există), este unică.
O matrice pătratică se numește \textit{singulară (sau degenerată)} dacă
determinantul său este nul. În caz contrar, se numește \textit{nesingulară}.

\newtheorem{th_matrixinverse}[th_detcompute]{Teoremă}
\label{theorem:matrix_inverse}
\begin{th_matrixinverse}
Fie \textbf{A} o matrice pătratică de ordinul \textit{n} din $\mathfrak{R}_{n}$.
Atunci matricea \textbf{A} este inversabilă dacă și numai dacă det(A) este nenul
(matricea A este nesingulară).
\end{th_matrixinverse}

Pentru a găsi inversa unei matrici, procedăm în felul următor.
Fie
\[
A = 
\begin{bmatrix}
a_{11} & a_{12} & \dots & a_{1n} \\
a_{21} & a_{22} & \dots & a_{2n} \\
\hdotsfor{4} \\
a_{n1} & a_{n2} & \dots & a_{nn}
\end{bmatrix}
\] o matrice pătratică de ordinul n. Construim \textit{matricea adjunctă}
$\mathbf{A^\star}$ a matricii \textbf{A},
\begin{equation*}
\mathbf{A^\star} = 
\begin{bmatrix}
A_{11} & A_{12} & \dots & A_{1n} \\
A_{21} & A_{22} & \dots & A_{2n} \\
\hdotsfor{4} \\
A_{n1} & A_{n2} & \dots & A_{nn}
\end{bmatrix},
\end{equation*} al cărei element $\mathit{A_{ij}}$ de pe linia \textit{i} și
coloana \textit{j} este complementul algebric al elementului $\mathit{a_{ij}}$
din matricea \textbf{A}.
Atunci, inversa matricii \textbf{A} se poate calcula după formula :
\begin{equation}
\label{mat:matrix_inverse}
\mathbf{A^{-1}} = \frac{1}{det(A)} \cdot A^{*},
\end{equation} adică împărțind matricea adjunctă matricii \textbf{A} la
valoarea determinantului matricii \textbf{A}.

Un alt procedeu prin care putem găsi inversa unei matrici este algoritmul
Gauss-Jordan. Acest procedeu se folosește de faptul ca asupra unei linii a unei
matrici pot fi aplicate următoarele \textit{operații elementare} :
\begin{enumerate}[(a)]
  \item interschimbarea a două linii
  \item înmulțirea unei linii cu un scalar non-zero
  \item înmulțirea unei linii cu un scalar și adunarea ei la altă linie
  \end{enumerate}
Pentru a găsi inversa unei matrici pătratice \textbf{A}, de ordinul \textit{n},
începem prin a construi o matrice adițională $n \times 2n$, prin concatenarea 
matricii identice $\mathbf{I_{n}}$ la dreapta matricii inițiale :
\begin{equation}
\label{eq:augm_matrix}
\tilde{A} = 
\begin{bmatrix}
a_{11} & a_{12} & \dots & \vert & 1 & 0 & \dots & 0 \\
a_{21} & a_{22} & \dots & \vert & 0 & 1 & \dots & 0 \\
\hdotsfor{8} \\
a_{n1} & a_{n2} & \dots & \vert & 0 & 0 & \dots & 1
\end{bmatrix}
\end{equation}
Apoi, prin \textit{operații elementare} asupa matricii $\tilde{A}$, se încearcă
aducerea matricii din partea stângă la matricea unitate $\mathbf{I_{n}}$,
procedeul având ca rezultat obținerea în partea dreaptă a matricii inverse
matricii \textbf{A}.

\begin{algorithm}
\caption{Eliminare Gauss-Jordan}
\label{alg:gauss_jordan_elim}
\begin{algorithmic}
\STATE Input : o matrice pătratică A de ordin n.
\STATE Output : inversa matricii A, dacă există.
\begin{enumerate}[{Pas} 1.]
  \item Se construiește matricea $\tilde{A}$ din ecuația \eqref{eq:augm_matrix}.
  \item Se parcurg toate coloanele de la 1 la n.
  \item Se identifică rândul \textit{i}, cu $\mathit{i \geq j}$ astfel încât
  $\tilde{A}_{ij}$ să aibe valoarea absolută cea mai mare. Dacă un astfel de
  rând nu există, matricea nu are inversă și algoritmul se oprește.
  \item Daca $\mathit{i \neq j}$, atunci se interschimbă rândurile 
  \textit{i, j}. Aceasta este operația de pivotare necesară pentru a îndepărta
  zerourile de pe diagonala principală și pentru a asigura stabilitate numerică.
  \item Multiplică rândul \textit{j} cu $1 \text{/} \tilde{A}_{jj}$. Această
  operație face ca elementul \textit{(j, j)} să devină egal cu 1.
  \item Pentru fiecare rând \textit{r}, cu $\mathit{1 \leq r \leq n}$ și $r
  \neq j$, adună rândul \textit{j} înmulțit cu $-\tilde{A}_{rj}$ la rândul
  \textit{r}. Această operație face ca toate elementele de pe coloana
  corespunzătoare elementului \textit{(j, j)} să devină egale cu zero.
  \item Dacă $\mathit{j < n}$ incrementează \textit{j} și se revine la pasul 2.
\end{enumerate}
\end{algorithmic}
\end{algorithm}

\subsection{Implementarea în codul aplicației a conceptului de matrice.}
\label{ch1:sec_matrix:sub_matrix_appcode}
\indent

Librăria \textbf{gfx\_lib} conține clase pentru matrici pătratice de ordinul 2,
3 și 4, precum și pentru matrici de dimensiuni arbitrare. Clasele sunt
similare ca și concept si funcționalitate, cu unele diferențe. Clasele sunt clase template,
fiind parametrizate cu tipul elementelor stocate, permițând astfel matrici cu
elemente numere intregi sau matrici cu elemente numere reale stocate prin
reprezentare în virgulă mobilă cu simplă/dublă precizie. De asemenea, ele oferă
suport pentru operațiile cu matrici prezentate anterior (transpunerea unei
matrici, calcularea determinantului, a inversei (dacă există), adunare,
scădere, inmulțire cu scalari/matrici, etc).
\todo{Inserat cod sursa pentru matrici aici}
